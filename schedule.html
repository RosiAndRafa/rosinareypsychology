<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendar una Cita</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
</head>
<body>

<h1>Agendar una Cita</h1>
<p>Selecciona una fecha:</p>

<!-- Calendar Booking -->
<div id="calendar"></div>

<p>Selecciona una hora:</p>
<div id="time-slots"></div>

<button id="confirm-button" style="display: none;">Confirmar Reserva</button>

<!-- Success Message -->
<div id="success-message" style="display: none;">
    <p>¡Tu cita ha sido reservada con éxito!</p>
</div>

<!-- Calendar and Booking Logic -->
<script>
    const bookedSlots = [];
    let selectedDate = null;
    let selectedTime = null;

    flatpickr("#calendar", {
        locale: "es",
        minDate: "today",
        onChange: function(selectedDates, dateStr) {
            selectedDate = dateStr;
            renderTimeSlots(dateStr);
        }
    });

    function renderTimeSlots(date) {
        const timeSlotsContainer = document.getElementById("time-slots");
        timeSlotsContainer.innerHTML = "";
        
        const timezoneOffset = new Date().getTimezoneOffset() / 60;
        const uruguayOffset = -3;

        for (let hour = 8; hour <= 20; hour++) {
            const localHour = hour + (timezoneOffset - uruguayOffset);
            const timeString = `${date} ${localHour.toString().padStart(2, '0')}:00`;
            const button = document.createElement("button");
            button.textContent = `${localHour.toString().padStart(2, '0')}:00`;
            button.classList.add("time-slot");

            if (bookedSlots.includes(timeString)) {
                button.classList.add("disabled");
                button.disabled = true;
            }

            button.addEventListener("click", () => {
                document.querySelectorAll(".time-slot").forEach(btn => btn.classList.remove("selected"));
                button.classList.add("selected");
                selectedTime = timeString;
                document.getElementById("confirm-button").style.display = "block";
            });

            timeSlotsContainer.appendChild(button);
        }
    }

    // Booking confirmation
    document.getElementById('confirm-button').addEventListener('click', () => {
        if (selectedDate && selectedTime) {
            bookedSlots.push(selectedTime);

            document.getElementById('success-message').style.display = 'block';
            document.getElementById('confirm-button').style.display = 'none';

            // Send Email Notification
            fetch('https://formsubmit.co/ajax/rosinareyasis@gmail.com', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    Date: selectedTime,
                    Message: 'New appointment booked at: ' + selectedTime
                })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));

            console.log("Appointment booked for:", selectedTime);
        } else {
            alert("Por favor, selecciona una fecha y hora.");
        }
    });
</script>

</body>
</html>
